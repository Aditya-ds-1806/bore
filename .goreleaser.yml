version: 2

before:
  hooks:
    - go mod tidy

builds:
  - 
    id: bore-server
    binary: bore-server
    main: ./cmd/bore-server/main.go
    env:
      - CGO_ENABLED=0
    ldflags:
      - "-s -w -X 'main.AppVersion={{.Version}}'"
    targets:
      - go_first_class

  - 
    id: bore-client
    binary: bore
    main: ./cmd/bore/main.go
    env:
      - CGO_ENABLED=0
    ldflags:
      - "-s -w -X 'main.AppVersion={{.Version}}' -X 'bore/internal/client.BoreServerHost=app.trybore.com' -X 'bore/internal/client.WSScheme=wss'"
    targets:
      - go_first_class

source:
  enabled: true
  name_template: "{{ .ProjectName }}-{{ .Version }}"
  format: "tar.gz"

signs:
  -
    cmd: cosign
    artifacts: checksum
    signature: "${artifact}.bundle"
    args:
      - sign-blob
      - "--yes"
      - "--bundle=${signature}"
      - "${artifact}"

report_sizes: true

release:
  footer: >-

    ---

    Released by [GoReleaser](https://github.com/goreleaser/goreleaser).
